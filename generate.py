"""This file defines the class NgramModel. It accepts a list of tokenized sentences (in the form generated by CorpusReader.sents()).
It removes punctuation tokens, converts all words to lower case, adds 1 sentence-end token (</s>) at the end of each sentence, adds 
n-1 sentence-start tokens (<s>) at the beginning of each sentence. It Uses the result to pre-calculate and store the frequency tables
needed by the methods listed below. Store the frequency tables in a variable inside the class. It also includes the method probability,
which returns the n-gram probability of the item we pass it, given the corpus; the method sentence perplexity, which returns the perplexity
of a given sentence; and the method choose successor, which probabilistically chooses a successor using the model. """

#TODO comment pretty and take away examples and jupyter notebook markings





import nltk
from corpusreader import CorpusReader
from model import NgramModel


def generate_sentence(model):
    prefix = ['<s>'] * (model.n-1)
    while True:
        next_word = model.choose_successor(prefix)
        if next_word is None or next_word == '</s>':
            break
        prefix.append(next_word)
        if len(prefix) >= model.n-1:
            prefix = prefix[-(model.n-1):]
    return ' '.join(prefix[(model.n-1):])

if __name__ == '__main__':


    
    # Create model
    model = NgramModel("C:/Users/Adrian/OneDrive/Desktop/comput ling/small-corpus", 2)
    
    # Generate samples
print("Generated sentences:")
for _ in range(2):
    print(generate_sentence(model))
    
    # Test perplexity
    test_cases = [
        "where the Norweyan",
        "so well thy words smack",
        "for for for"
    ]
    
    print("\nPerplexity tests:")
    for text in test_cases:
        tokens = nltk.word_tokenize(text)
        pp = model.perplexity(tokens)
        print(f"'{text}': {pp}")

# Initialize CorpusReader
corpus_reader = CorpusReader("C:/Users/Adrian/OneDrive/Desktop/comput ling/small-corpus")
test_sentences = corpus_reader.sents()

corpus_path = r'C:/Users/Adrian/OneDrive/Documents/GitHub/homework-assignment-1/corpus'
print(f"Initializing CorpusReader with path: {corpus_path}")
corpus = CorpusReader(corpus_path)

from model import NgramModel
model = NgramModel(sentences, 2)
testngram = tuple(['so','well'])
model.probability(ngram = testngram, k =1)